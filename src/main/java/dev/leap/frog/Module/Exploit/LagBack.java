package dev.leap.frog.Module.Exploit;

import dev.leap.frog.Module.Module;
import dev.leap.frog.Settings.Setting;
import dev.leap.frog.Util.Render.Chatutil;
import net.minecraft.network.play.client.CPacketPlayer;

public class LagBack extends Module {

    public LagBack() {
        super("LagBack", "Lags you back x amount of blocks", Type.EXPLOIT);
    }

    Setting<Integer> distance = create("Distance", 3, 0, 10);
    Setting<Boolean> notify = create("Notify", false);
    Setting<Boolean> spoof = create("Spoof", false);

    double x, y, z;
    private boolean canMove;

    @Override
    public void onEnable() {
            this.x = mc.player.posX;
            this.y = mc.player.posY;
            this.z = mc.player.posZ;

        this.canMove = false;
        if(notify.getValue()) {
            Chatutil.sendMessage("Starting position X: " + StrictMath.floor(x) + "Y: " + StrictMath.floor(y) + "Z: " + StrictMath.floor(z));
        }
    }

    @Override
    public void onUpdate() {

        if(mc.player.getDistance(x, y, z) > distance.getValue()) { // checking if player has lagged back from starting position
            Chatutil.sendClientSideMessgage("Passed first position");
        }

        if(!canMove) {
            if (mc.player.getDistance(x, y, z) >= distance.getValue()) {
                mc.player.setPosition(x, y, z);
                this.x = mc.player.posX;
                this.y = mc.player.posY;
                this.z = mc.player.posZ;
                if(spoof.getValue()) {
                    mc.player.connection.sendPacket(new CPacketPlayer.Position(this.x, this.y, this.z, mc.player.onGround));
                }
                canMove = true;
                toggle();
            }
        }
    }

    @Override
    public void onDisable() {
        this.canMove = false;
    }
}
