package dev.leap.frog.Module.Exploit;

import dev.leap.frog.Event.Network.EventPacket;
import dev.leap.frog.Module.Module;
import dev.leap.frog.Util.Render.Chatutil;
import me.zero.alpine.fork.listener.EventHandler;
import me.zero.alpine.fork.listener.Listener;
import net.minecraft.network.play.server.SPacketChat;

//TODO: rewrite
public class AntiLog4J extends Module {

    public AntiLog4J() {
        super("AntiLog4J", "Prevents vulnerability to log4j exploit", Type.EXPLOIT);
    }

    @EventHandler
    private Listener<EventPacket.ReceivePacket> packetListener = new Listener<>(event -> {
        if(event.getPacket() instanceof SPacketChat) {
            SPacketChat packet = (SPacketChat) event.getPacket();
            String message = packet.getChatComponent().getFormattedText();
            if(message.contains("${")) {
                Chatutil.sendClientSideMessgage("Potential exploits being used, blocking chat messages");
                event.cancel();
            }
        }
    });
}
